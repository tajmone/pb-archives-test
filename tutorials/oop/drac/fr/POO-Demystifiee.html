<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5.dev">
<meta name="author" content="Dräc">
<title>PureBasic et la Programmation Orientée Objet — ou «la POO démystifiée»</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>PureBasic et la Programmation Orientée Objet</h1>
<div class="details">
<span id="author" class="author">Dräc</span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">December 6, 2016</span>
<br><span id="revremark">Reprinted and revised edition.</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#pourquoi-de-la-poo-en-purebasic">Pourquoi de la POO en PureBasic ?</a></li>
<li><a href="#les-concepts-objets">Les concepts objets</a>
<ul class="sectlevel2">
<li><a href="#la-notion-d-objet">La notion d’objet</a></li>
<li><a href="#la-notion-de-classe">La notion de Classe</a></li>
<li><a href="#la-notion-d-instance">La notion d’instance</a></li>
<li><a href="#l-encapsulation">L’encapsulation</a></li>
<li><a href="#l-h-ritage">L’héritage</a></li>
<li><a href="#la-surcharge">La surcharge</a></li>
<li><a href="#notion-de-classe-abstraite">Notion de Classe abstraite</a></li>
</ul>
</li>
<li><a href="#premi-re-impl-mentation">Première Implémentation</a>
<ul class="sectlevel2">
<li><a href="#classe-concr-te-et-classe-abstraite">Classe concrète et Classe abstraite</a></li>
<li><a href="#instanciation">Instanciation</a></li>
<li><a href="#encapsulation">Encapsulation</a></li>
<li><a href="#h-ritage">Héritage</a></li>
<li><a href="#surcharge">Surcharge</a></li>
<li><a href="#conclusion">Conclusion :</a></li>
</ul>
</li>
<li><a href="#l-instruction-interface">L’instruction Interface</a>
<ul class="sectlevel3">
<li><a href="#initialisation">Initialisation :</a></li>
</ul>
</li>
<li><a href="#deuxi-me-impl-mentation">Deuxième Implémentation</a>
<ul class="sectlevel2">
<li><a href="#notion-d-interface-objet">Notion d’interface Objet :</a></li>
<li><a href="#instanciation-et-constructeur-d-objet">Instanciation et Constructeur d’Objet</a></li>
<li><a href="#initialisation-d-objet">Initialisation d’Objet</a></li>
<li><a href="#destructeur-d-objet">Destructeur d’Objet</a></li>
<li><a href="#allocations-m-moire">Allocations Mémoire</a></li>
<li><a href="#encapsulation-2">Encapsulation</a></li>
<li><a href="#h-ritage-2">Héritage</a></li>
<li><a href="#accesseur-et-modifieur-d-objet">Accesseur et Modifieur d’Objet</a></li>
</ul>
</li>
<li><a href="#synth-se-et-notation">Synthèse et notation</a>
<ul class="sectlevel2">
<li><a href="#premier-exemple-de-code">Premier Exemple de Code</a></li>
</ul>
</li>
<li><a href="#classe-pb">Classe PB</a>
<ul class="sectlevel2">
<li><a href="#classe-purebasic">Classe PureBasic</a></li>
<li><a href="#deuxi-me-exemple-de-code">Deuxième Exemple de Code</a></li>
<li><a href="#class-endclass">Class : EndClass</a></li>
<li><a href="#method-endmethod">Method : EndMethod</a></li>
<li><a href="#le-constructeur-de-l-objet">Le constructeur de l’objet</a></li>
<li><a href="#destructeur-de-l-objet">Destructeur de l’objet</a></li>
<li><a href="#h-ritage-3">Héritage</a></li>
<li><a href="#discussion">Discussion</a></li>
<li><a href="#rappel-des-types">Rappel des types</a></li>
</ul>
</li>
<li><a href="#conclusion-2">Conclusion</a></li>
<li><a href="#optimisations">Annexe A: Optimisations</a>
<ul class="sectlevel2">
<li><a href="#optimisation-accesseurs-et-aux-modifieurs">Optimisation: Accesseurs et aux Modifieurs:</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">About This Tutorial</div>
<div class="paragraph">
<p><strong>CREDITS</strong>: This is a reprint of «Dräc»’s multi-part tutorial <em>PureBasic et la Programmation Orientée Objet</em>, also knwon as <em>la POO démystifiée</em>, published in 2005  on <a href="http://drac.site.chez-alice.fr/Tutorials%20Programming%20PureBasic/POO/POO_Pourquoi.htm">drac.site.chez-alice.fr</a>.</p>
</div>
<div class="paragraph">
<p><strong>LICENSE</strong>: It was reprinted with explicit permission of the author, who released the tutorial text and source codes under <a href="https://creativecommons.org/licenses/by/4.0/deed.fr">Creative Commons Attribution</a>  (CC BY 4.0) in response to the permission request to reproduce it inside the <a href="https://github.com/tajmone/purebasic-archives">PureBASIC Archives</a>.</p>
</div>
<div class="paragraph">
<p><strong>CHANGES</strong>: The tutorial was ported from HTML to AsciiDoc by <a href="https://github.com/tajmone">Tristano Ajmone</a>, who also made minor changes to code examples (either aesthetic, or minor corrections, or to ensure compatibility with latest version of PureBASIC).</p>
</div>
<div class="paragraph">
<p>First republished: 2016/12/06 — by <a href="https://github.com/tajmone">@tajmone</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pourquoi-de-la-poo-en-purebasic"><a class="anchor" href="#pourquoi-de-la-poo-en-purebasic"></a>Pourquoi de la POO en PureBasic ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Il peut sembler surprenant de chercher à réaliser en PureBasic, qui est un langage procédural, une représentation orientée objet, d’autant que de nombreux langages adaptés à la POO existent.</p>
</div>
<div class="paragraph">
<p>Mais que certains langages de programmation soient « Objets » et que d’autres ne le soient pas, traduit uniquement l’existence de mots-clés supplémentaires qui facilitent l’écriture de ces programmes.
Ainsi, les langages orientés-objets enrichissent la sémantique mais ne modifient en rien l’aspects de la compilation par rapport à un langage non-Objet. Ils ne font que rajouter une couche au-dessus de ce dernier.</p>
</div>
<div class="paragraph">
<p>On peut donc tout à fait en implémenter les concepts en PureBasic au prix d’une certaine rigueur de développement et de notation. C’est là que se situe l’avantage immédiat des langages Objets.</p>
</div>
<div class="paragraph">
<p>Néanmoins, la mise en œuvre de la méthode objet en PureBasic offre, outre la possibilité de programmer selon cette philosophie, l’intérêt de dévoiler certains mécanismes sous-jacents des mots-clés des langages objets.</p>
</div>
<div class="paragraph">
<p>Cet article présente une technique de programmation permettant à des projets PureBasic d’envergure de bénéficer d’une conception orienté objet. Il est entendu qu’il ne s’agit pas ici d’un cours des techniques POO et que le lecteur possède une bonne connaissance du langage PureBasic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="les-concepts-objets"><a class="anchor" href="#les-concepts-objets"></a>Les concepts objets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La Programmation Orientée Objet introduit des concepts comme l’objet, l’héritage ou le polymorphisme.
Nous allons essayer de voir comment les principaux concepts peuvent être réalisés en PureBasic.
Mais avant cela, il nous faut définir ces concepts.</p>
</div>
<div class="sect2">
<h3 id="la-notion-d-objet"><a class="anchor" href="#la-notion-d-objet"></a>La notion d’objet</h3>
<div class="paragraph">
<p>Un objet possède un état interne:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>L’état est représenté par la valeur de chacun de ses composants à un instant donné,</p>
</li>
<li>
<p>Un composant est soit une valeur, soit un autre objet.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il utilise et met à disposition des services :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Il interagit avec l’extérieur par l’intermédiaire de fonctions appelées méthodes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il est unique (notion d’identité)</p>
</div>
<div class="paragraph">
<p>Un objet peut être vue de deux façons :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>De part les services qu’il rend : vue externe (spécification). C’est le côté utilisateur,</p>
</li>
<li>
<p>De part la manière dont sont implémentés, en son sein, les services : vue interne (implémentation). C’est le côté développeur.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Du point de vu du développeur, l’objet est donc une zone mémoire contiguë contenant des informations : des variables appelées <strong>attributs</strong> et des fonctions appelées <strong>méthodes</strong>.
Le fait que l’on appelle les fonctions d’un objet des méthodes, tient au fait qu’elles sont propres à l’objet et permettent la manipulation des attributs de cet objet.</p>
</div>
</div>
<div class="sect2">
<h3 id="la-notion-de-classe"><a class="anchor" href="#la-notion-de-classe"></a>La notion de Classe</h3>
<div class="paragraph">
<p>Il s’agit d’une extension de la notion de <strong>type</strong> que l’on trouve en PureBasic.</p>
</div>
<div class="paragraph">
<p>Dans un contexte donné, plusieurs objets peuvent posséder la même structure et le même comportement.
On les regroupe alors dans une même " <strong>Classe</strong> ".</p>
</div>
<div class="paragraph">
<p>Du point de vu du développeur, la Classe définit ce que contient un objet de cette classe : la nature de ses attributs (type de chaque variable) et ses méthodes (noms, implémentations).</p>
</div>
<div class="paragraph">
<p>Si le type d’une variable est un entier, le type d’un objet est sa Classe.</p>
</div>
</div>
<div class="sect2">
<h3 id="la-notion-d-instance"><a class="anchor" href="#la-notion-d-instance"></a>La notion d’instance</h3>
<div class="ulist">
<ul>
<li>
<p>Une instance est un objet défini à partir d’une classe.</p>
</li>
<li>
<p>Un tel processus s’appelle l’<strong>instanciation</strong>.</p>
</li>
<li>
<p>Cela correspond à la déclaration de variables dans PureBasic.</p>
</li>
<li>
<p>L’objet est <strong>normalement initialisé</strong> dès sa création.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="l-encapsulation"><a class="anchor" href="#l-encapsulation"></a>L’encapsulation</h3>
<div class="paragraph">
<p>En théorie, on ne devrait pouvoir manipuler les attributs d’un objet qu’en passant par les méthodes. Cette technique, qui permet de ne rendre visible à l’utilisateur qu’une partie de l’objet, est appelée <strong>encapsulation</strong>.</p>
</div>
<div class="paragraph">
<p>L’encapsulation a comme avantage de garantir l’intégrité des attributs. En effet, c’est le développeur qui, par l’intermédiaire des méthodes mises à la disposition de l’utilisateur, maîtrise les modifications apportées à l’objet.</p>
</div>
<div class="paragraph">
<p>C’est du moins, à notre niveau ce que l’on en retiendra.</p>
</div>
</div>
<div class="sect2">
<h3 id="l-h-ritage"><a class="anchor" href="#l-h-ritage"></a>L’héritage</h3>
<div class="paragraph">
<p>L’héritage permet de définir de nouvelles Classes en utilisant des Classes déjà existantes.</p>
</div>
<div class="paragraph">
<p>Du point de vue du développeur, cela revient à pouvoir ajouter des attributs et des méthodes à ceux existants dans une Classe pour en définir une autre, voir même à <strong>modifier</strong> certaines méthodes.</p>
</div>
<div class="paragraph">
<p>Il existe deux types d’héritages :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>L’héritage simple</strong> : La nouvelle Classe est définie à partir d’une seule Classe existante</p>
</li>
<li>
<p><strong>L’héritage multiple</strong> : La nouvelle Classe est définie à partir de plusieurs Classes existantes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bien que possible à programmer, l’héritage multiple est complexe à mettre en œuvre et ne sera pas abordé ici.</p>
</div>
<div class="paragraph">
<p>Nous nous limiterons à l’héritage simple.</p>
</div>
<div class="paragraph">
<p><span class="big"><strong>Terminologie:</strong></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>La Classe qui hérite d’une autre Classe, est souvent appelée <strong>Classe Fille</strong>.</p>
</li>
<li>
<p>La Classe qui donne son héritage à une Classe Fille est souvent appelée <strong>Classe Mère</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="la-surcharge"><a class="anchor" href="#la-surcharge"></a>La surcharge</h3>
<div class="paragraph">
<p>On dit qu’une méthode est surchargée, si elle réalise des actions différentes selon la nature des objets visés.</p>
</div>
<div class="paragraph">
<p>Prenons un exemple :</p>
</div>
<div class="paragraph">
<p>Les objets suivants: cercle, rectangle et triangle sont des formes géométriques.
On peut définir pour ces objets une même Classe qu’on appellera <code>Forme</code>.
Les objets sont donc des instances de la classe <code>Forme</code>.</p>
</div>
<div class="paragraph">
<p>Si on veut afficher les objets, il faut que la classe <code>Forme</code> dispose d’une méthode <code>Dessiner</code>.</p>
</div>
<div class="paragraph">
<p>Ainsi doté, chaque objet dispose donc d’une méthode <code>Dessiner</code> pour s’afficher. Or, cette méthode ne peut-être la même selon que l’on veut afficher un cercle ou un rectangle.</p>
</div>
<div class="paragraph">
<p>Les objets d’une même Classe utilisent donc la même méthode <code>Dessiner</code>, mais la nature de l’objet (Rectangle, Triangle) spécifie l’implémentation de la méthode.</p>
</div>
<div class="paragraph">
<p>On dit que la méthode Dessiner est surchargée: du point de vu de l’utilisateur afficher un cercle ou un rectangle se fait de la même manière, ceci en toute transparence.</p>
</div>
<div class="paragraph">
<p>Du point de vue du développeur, l’implémentation des méthodes diffère.</p>
</div>
<div class="paragraph">
<p>Au lieu de méthode surchargée, on peut parler aussi de méthode polymorphe (ayant plusieurs formes).</p>
</div>
</div>
<div class="sect2">
<h3 id="notion-de-classe-abstraite"><a class="anchor" href="#notion-de-classe-abstraite"></a>Notion de Classe abstraite</h3>
<div class="paragraph">
<p>Nous avons vu qu’une Classe regroupe la définition des attributs d’un objet ainsi que ces méthodes.
Supposons que l’on ne puisse pas donner l’implémentation d’une des méthodes de la Classe. La méthode n’est qu’un nom sans code. On parle alors de <strong>méthode abstraite</strong>.
Une Classe comportant au moins une méthode abstraite est qualifiée de <strong>Classe abstraite</strong>.</p>
</div>
<div class="paragraph">
<p>On peut se demander la raison d’être d’une classe abstraite puisque l’on ne peut créer d’objet d’une telle Classe. Les Classes abstraites permettent de définir des <a href="#la-notion-de-classe">Classes d’objets</a> qualifiées par opposition de concrètes. Le passage de l’une à l’autre se fait par héritage en prenant le soin de donner les implémentations nécessaires aux méthodes abstraites.</p>
</div>
<div class="paragraph">
<p>Les Classes abstraites ont donc un rôle d’interface, car qu’elles décrivent la spécification générique de toutes les Classes qui en hérite.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="premi-re-impl-mentation"><a class="anchor" href="#premi-re-impl-mentation"></a>Première Implémentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dans ce qui va suivre, nous allons voir comment les concepts objets qui viennent d’être abordés peuvent être implémentés en PureBasic.
En aucun cas cela fait référence à ce qui est programmé dans les langages objets. De plus, le propre de l’implémentation c’est de pouvoir être amélioré ou de s’adapter au besoin.</p>
</div>
<div class="paragraph">
<p>Nous proposons donc ici une de ces d’implémentations avec ses avantages et ses limites.</p>
</div>
<div class="sect2">
<h3 id="classe-concr-te-et-classe-abstraite"><a class="anchor" href="#classe-concr-te-et-classe-abstraite"></a>Classe concrète et Classe abstraite</h3>
<div class="paragraph">
<p>Comme nous l’avons vu, la Classe définie ce que contient un objet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ses attributs (type de chaque variable)</p>
</li>
<li>
<p>ses méthodes (noms, implémentation)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Si, par exemple, on veut représenter des objets Rectangle et les afficher à l’écran, on définira donc une Classe <code>Rectangle</code> possédant une méthode <code>Dessiner()</code>.</p>
</div>
<div class="paragraph">
<p>La Classe <code>Rectangle</code> pourrait avoir la construction suivante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle
  *Dessiner
  x1.l
  x2.l
  y1.l
  y2.l
EndStructure

Procedure Dessiner_Rectangle(*this.Rectangle)
  ; [ ...some code... ]
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>où <code>x1</code>, <code>x2</code>, <code>y1</code> et <code>y2</code> sont quatre attributs (les coordonnées des points diamétralement opposés du rectangle) et <code>*Dessiner</code> est un pointeur faisant référence à la fonction de dessin qui affiche les Rectangles.</p>
</div>
<div class="paragraph">
<p><code>*Dessiner</code> est ici un pointeur de fonction utilisé pour contenir l’adresse de la fonction désirée : <code>@Dessiner_Rectangle()</code>.
Il suffit d’utiliser <code>CallFunctionFast()</code> pour lancer l’exécution de la fonction ainsi référencée.</p>
</div>
<div class="paragraph">
<p>Nous voyons donc que l’instruction Structure est tout à fait adaptée à la notion de Classe:
*   Nous y trouvons la définition des attributs d’un objet : ici <code>x1</code>, <code>x2</code>, <code>y1</code> et <code>y2</code> sont de type entier Long.
*   Nous y trouvons la définition des méthodes : ici <code>Dessiner()</code> grâce à un pointeur de fonction.</p>
</div>
<div class="paragraph">
<p>Si la Classe ainsi définie est suivit de l’implémentation des méthodes (dans notre exemple il s’agit de la déclaration du bloc Procedire/EndProcedure de <code>Dessiner_Rectangle()</code>), la Classe sera une Classe concrète.
Dans le cas contraire elle sera abstraite.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On appelle toujours <code>*this</code>, le pointeur vers l’objet auquel on applique la méthode. Cette notation est appliquée dans notre exemple avec la méthode <code>Dessiner_Rectangle()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="instanciation"><a class="anchor" href="#instanciation"></a>Instanciation</h3>
<div class="paragraph">
<p>Si l’on désire créer maintenant un objet <code>Rect1</code> issu de la classe <code>Rectangle</code>, cela revient à écrire :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect1.Rectangle</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour l’initialiser, il suffit d’écrire :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect1\Dessiner = @Dessiner_Rectangle()
Rect1\x1 = 0
Rect1\x2 = 10
Rect1\y1 = 0
Rect1\y2 = 20</code></pre>
</div>
</div>
<div class="paragraph">
<p>Par la suite, pour dessiner l’objet <code>Rect1</code>, on écrira:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">CallFunctionFast(Rect1\Dessiner, @Rect1)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="encapsulation"><a class="anchor" href="#encapsulation"></a>Encapsulation</h3>
<div class="paragraph">
<p>Dans cette implémentation, l’encapsulation n’existe pas, tout simplement car il n’y a pas moyen de cacher les attributs ou les méthodes d’un tel objet.</p>
</div>
<div class="paragraph">
<p>En effet, il suffit d’écrire <code>Rect1\x1</code> pour accéder à l’attribut <code>x1</code> de l’objet. C’est d’ailleurs ce moyen que nous avons utilisé pour initialiser l’objet.
Nous verrons dans la deuxième implémentation, comment cela peut changer.
Cependant, cette notion, bien qu’important, n’est pas la plus essentielle pour faire de la POO.</p>
</div>
</div>
<div class="sect2">
<h3 id="h-ritage"><a class="anchor" href="#h-ritage"></a>Héritage</h3>
<div class="paragraph">
<p>Imaginons maintenant que l’on souhaite créer une nouvelle Classe d’objet <code>Rectangle</code> capable en plus de s’effacer de l’écran.
On peut se servir de la Classe existante <code>Rectangle</code> et y adjoindre la nouvelle méthode <code>Effacer()</code> pour créer la nouvelle Classe <code>Rectangle2</code>.</p>
</div>
<div class="paragraph">
<p>Une Classe étant une <code>Structure</code>, nous allons profiter de la propriété qu’a une structure d’être étendue. Ainsi, la nouvelle Classe <code>Rectangle2</code> peut s’écrire :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle2 Extends Rectangle
  *Effacer
EndStructure

Procedure Effacer_Rectangle(*this.Rectangle2)
  ; [ ...some code... ]
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>La Classe <code>Rectangle2</code> possède donc bien les membres de la Classe <code>Rectangle</code> et une nouvelle méthode <code>Effacer()</code>.</p>
</div>
<div class="paragraph">
<p>En effet, l’instanciation d’un objet de cette Classe donne :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect2.Rectangle2

Rect2\Dessiner = @Dessiner_Rectangle()
Rect2\Effacer = @Effacer_Rectangle()
Rect2\x1 = 0
Rect2\x2 = 10
Rect2\y1 = 0
Rect2\y2 = 20</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour utiliser les méthodes <code>Dessiner()</code> et <code>Effacer()</code> de <code>Rect2</code>, on procèdera de la même manière que précédemment.</p>
</div>
<div class="paragraph">
<p>Nous pouvons donc dire que <code>Rectangle2</code> a hérité des propriétés de la Classe <code>Rectangle</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>L’héritage est une forme de polymorphisme. L’objet <code>Rect2</code> peut etre vu comme un Objet de la Classe <code>Rectangle</code>, il suffit de ne pas se servir de la méthode <code>Effacer()</code>. Par héritage, l’objet revête donc plusieurs formes : celles des objets issus des différentes Classes Mères. On parle alors de polymorphisme d’héritage.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="surcharge"><a class="anchor" href="#surcharge"></a>Surcharge</h3>
<div class="paragraph">
<p>Lors de l’initialisation d’un objet, on initialise les pointeurs de fonction en leur affectant l’adresse de la méthode qui convient à l’objet.</p>
</div>
<div class="paragraph">
<p>Ainsi, pour un objet <code>Rect</code> de Classe <code>Rectangle</code>, en écrivant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect1\Dessiner = @Dessiner_Rectangle()</code></pre>
</div>
</div>
<div class="paragraph">
<p>on peut utiliser la méthode <code>Dessiner()</code> comme suite:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">CallFunctionFast(Rect1\Dessiner, @Rect1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maintenant, imaginons qu’il soit possible d’implémenter une autre méthode pour l’affichage d’un rectangle (utilisant un algorithme distinct de celui de la premiere méthode).</p>
</div>
<div class="paragraph">
<p>Appelons la <code>Dessiner_Rectangle2()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Dessiner_Rectangle2(*this.Rectangle)
  ; [ ...some code... ]
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il est tout à fait possible d’initialiser notre objet <code>Rect1</code> avec cette nouvelle méthode sans grande peine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect1\Dessiner = @Dessiner_Rectangle2()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si l’on veut utiliser la méthode on écrira à nouveau:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">CallFunctionFast(Rect1\Dessiner, @Rect1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nous constatons bien que dans un cas (méthode <code>Dessiner_Rectangle()</code>) comme dans l’autre (méthode <code>Dessiner_Rectangle2()</code>) l’utilisation de la méthode de l’objet <code>Rect1</code> est strictement identique.</p>
</div>
<div class="paragraph">
<p>Il ne nous est pas possible en effet par la seule ligne “<code>CallFunctionFast(Rect1\Dessiner, @Rect1)</code>”  de distinguer la méthode <code>Dessiner()</code> que l’objet <code>Rect1</code> utilise.
Pour y arriver, il faut remonter jusqu’à l’initialisation de l’objet.</p>
</div>
<div class="paragraph">
<p>La notion de pointeur de fonction permet donc la surcharge de la méthode <code>Dessiner()</code> de la Classe <code>Rectangle</code>.</p>
</div>
<div class="paragraph">
<p>Il y a tout de même une limitation dans cette surcharge. L’utilisation de l’instruction <code>CallFunctionFast()</code> implique de faire attention au nombre de paramètres.</p>
</div>
</div>
<div class="sect2">
<h3 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion :</h3>
<div class="paragraph">
<p>Dans cette première implémentation, nous disposons d’un objet capable de répondre aux principaux concepts orientés objet avec certaines limitations.</p>
</div>
<div class="paragraph">
<p>Nous venons surtout de poser les bases qui vont nous servir à réaliser un objet plus complet, ceci grâce à l’instruction <code>Interface</code> de PureBasic.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="l-instruction-interface"><a class="anchor" href="#l-instruction-interface"></a>L’instruction Interface</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Syntaxe :</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">Interface &lt;Nom1&gt; [Extends &lt;Nom2&gt;]
  [Procedure1]
  [Procedure2]
  ...
EndInterface</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>Interface</code> de PureBasic, permet de regrouper sous un même Nom (<code>&lt;Nom1&gt;</code> dans l’encadré) différentes procédures.</p>
</div>
<div class="paragraph">
<p>Ex :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Interface Mon_Objet
  Procedure1(x1.l, y1.l)
  Procedure2(x2.l, y2.l)
EndInterface</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il suffit de déclarer un élément de type <code>Mon_Objet</code> pour accéder aux procédures qu’elle détient.
La déclaration se fait de la même manière que pour une <code>Structure</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Objet.Mon_Objet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nous pouvons alors utiliser les fonctions de <code>Objet</code> directement comme suite:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Objet\Procedure1(10, 20)
Objet\Procedure2(30, 40)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lancer une procedure grâce à l’instruction <code>Interface</code> se fait par une notation fort pratique et agréable.
En écrivant “<code>Objet\Procedure1(10, 20)</code>”, on lance la <code>Procedure1()</code> de l’élément <code>Objet</code>.
Cette notation est typique de la Programmation Orienté Objet.</p>
</div>
<div class="sect3">
<h4 id="initialisation"><a class="anchor" href="#initialisation"></a>Initialisation :</h4>
<div class="paragraph">
<p>Comme toute déclaration d’une variable typée, il s’en suit normalement l’initialisation de la variable.
Il en est de même lorsque l’on déclare un élément dont le type provient d’une <code>Interface</code>.</p>
</div>
<div class="paragraph">
<p>Contre toute attente, il ne suffit pas de donner le nom d’une procédure à l’intérieur du bloc <code>Interface : EndInterface</code> pour que cela fasse référence à l’implémentation de cette procédure, c’est à dire que l’on référence le bloc <code>Procédure : EndProcedure</code> de la procédure voulue.</p>
</div>
<div class="paragraph">
<p>En réalité vous pouvez renommer les procédures dans un bloc <code>Interface : EndInterface</code>, c’est à dire donner les noms que vous voulez aux procédures que vous allez utiliser.</p>
</div>
<div class="paragraph">
<p>Comment relier alors ce nouveau nom à la vraie procédure ?</p>
</div>
<div class="paragraph">
<p>Comme pour la surcharge de méthode, la solution se trouve dans les adresses de fonctions.
Il faut voir en effet les noms contenus dans le bloc <code>Interface : EndInterface</code>, comme des pointeurs de fonctions auxquels on attribut les adresses des fonctions que l’on désire y mettre.</p>
</div>
<div class="paragraph">
<p>Cependant, pour initialiser les pointeurs de fonctions d’un élément typé par une <code>Interface</code>, il faut procéder différemment qu’avec un élément typé par une <code>Structure</code>.
Il n’est en effet pas possible d’initialiser individuellement chacun des champs définis par une Interface, car rappelez-vous que d’écrire <code>Objet\Procedure1()</code> revient à lancer une procédure.</p>
</div>
<div class="paragraph">
<p>L’initialisation se réalise indirectement en donnant à l’élément l’adresse d’une variable composée des pointeurs de fonctions préalablement initialisée.</p>
</div>
<div class="paragraph">
<p>Une telle variable est appelée table des méthods.</p>
</div>
<div class="paragraph">
<p>Ex : Si l’on reprend l’<code>Interface Mon_Objet</code>.</p>
</div>
<div class="paragraph">
<p>Considérons la <code>Structure</code> suivante de description des pointeurs de fonctions :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Mes_Methodes
  *Procedure1
  *Procedure2
EndStructure</code></pre>
</div>
</div>
<div class="paragraph">
<p>et la variable initialisée associée:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Methodes.Mes_Methodes
Methodes\Procedure1 = @Ma_Procedure1()
Methodes\Procedure2 = @Ma_Procedure2()</code></pre>
</div>
</div>
<div class="paragraph">
<p>où <code>Ma_Procedure1()</code> et <code>Ma_Procedure2()</code> sont les implémentations des procédures que l’on veut utiliser.</p>
</div>
<div class="paragraph">
<p>Alors, l’initialisation de l’élément <code>Objet</code> de type <code>Mon_Objet</code> se fera comme suite :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Objet.Mon_Objet = @Methodes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ainsi, en écrivant</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Objet\Procedure2(30, 40)</code></pre>
</div>
</div>
<div class="paragraph">
<p>on lance la fonction <code>Procedure2()</code> de l’élément <code>Objet</code>, c’est à dire <code>Ma_Procedure2()</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Lorsque l’on déclare un élément typé par une interface, il est obligatoire de l’initialiser avant de se servir des procédures de l’élément. Il est donc vivement conseillé d’initialiser l’élément dès sa déclaration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a id="admonition-structure-interface-symetrie"></a>La composition de la <code>Structure</code> décrivant les pointeurs de fonctions, doit être le reflet exact de la composition de l’<code>Interface</code>. C’est à dire qu’elle doit comporter le même nombre de champs et respecter l’ordre pour que l’attribution entre les noms et les adresses de chaque fonction soit celle attendue. C’est seulement à ces conditions que l’élément sera correctement initialisé.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pour résumer, utiliser une Interface c’est disposer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>d’une <code>Interface</code> décrivant les procédures que l’on veut utiliser,</p>
</li>
<li>
<p>d’une <code>Structure</code> décrivant les pointeurs d’adresses des fonctions,</p>
</li>
<li>
<p>d’une <strong>table des méthodes</strong>: variable initialisée issue de cette structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>C’est aussi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bénéficier d’une notation orientée objet,</p>
</li>
<li>
<p>pouvoir renommer facilement les procédures.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deuxi-me-impl-mentation"><a class="anchor" href="#deuxi-me-impl-mentation"></a>Deuxième Implémentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dans notre première implémentation, nombres de concepts ont été traduits d’une manière plus ou moins étendue.
Nous allons voir maintenant comment on peut améliorer cette implémentation grâce à l’utilisation de l’instruction <code>Interface</code>.</p>
</div>
<div class="sect2">
<h3 id="notion-d-interface-objet"><a class="anchor" href="#notion-d-interface-objet"></a>Notion d’interface Objet :</h3>
<div class="paragraph">
<p>Nous avons vu que la notion d’encapsulation avait comme but premier de rendre visible à l’utilisateur qu’une partie de l’objet.
La partie visible du contenu est appelée <strong>interface</strong>, l’autre partie cachée est appelée <strong>implémentation</strong>.</p>
</div>
<div class="paragraph">
<p>L’interface d’un objet est donc la seule porte d’entrée/sortie dont dispose l’utilisateur pour agir sur un objet.</p>
</div>
<div class="paragraph">
<p>C’est le rôle que l’on va donner dans notre utilisation de l’instruction Interface.</p>
</div>
<div class="paragraph">
<p>L’instruction <code>Interface</code> va donc nous permettre de regrouper sous un même Nom, tout ou partie des méthodes d’un objet que l’utilisateur aura le droit de manipuler.</p>
</div>
</div>
<div class="sect2">
<h3 id="instanciation-et-constructeur-d-objet"><a class="anchor" href="#instanciation-et-constructeur-d-objet"></a>Instanciation et Constructeur d’Objet</h3>
<div class="paragraph">
<p>Vouloir utiliser une interface c’est d’abord se munir :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>d’une <code>Interface</code> décrivant les méthodes que l’on veut utiliser,</p>
</li>
<li>
<p>d’une <code>Structure</code> décrivant les pointeurs d’adresses des fonctions correspondantes,</p>
</li>
<li>
<p>d’une <strong>table des méthodes</strong>: variable initialisée issue de cette structure.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L’étape 1, consistant à d’écrire l’<code>Interface</code> d’un objet, n’est pas compliquée. Il suffit de nommer les méthodes.</p>
</div>
<div class="paragraph">
<p>Les étapes 2 et 3 sont liées. Or dans notre approche objet, nous disposons déjà de la <code>Structure</code> adaptée: c’est celle qui décrit la Classe d’un objet.
En effet, l’Interface et la Classe d’un objet se ressemblent: Tous deux comportent des pointeurs de fonctions.
Simplement, l’instruction Interface ne contient pas les attributs de la Classe mais seulement tout ou partie des méthodes de la Classe.</p>
</div>
<div class="paragraph">
<p>Il est donc tout à fait possible de se servir de la Classe d’un objet pour initialiser l’interface. Cette démarche est d’ailleurs des plus naturelles. Rappelons que l’interface est la partie visible de la Classe d’un objet, il est donc normal que l’interface soit déterminée par la Classe.</p>
</div>
<div class="paragraph">
<p>Voyons comment procéder.
Reprenons la Classe Rectangle2 munie des deux méthodes : <code>Dessiner()</code> et <code>Effacer()</code></p>
</div>
<div class="paragraph">
<p>Sa Classe est la suivante</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle2
  *Dessiner
  *Effacer
  x1.l
  x2.l
  y1.l
  y2.l
EndStructure

Procedure Dessiner_Rectangle(*this.Rectangle2)
  ; [ ...some code... ]
EndProcedure

Procedure Effacer_Rectangle(*this.Rectangle2)
  ; [ ...some code... ]
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Définissons maintenant l’interface suivante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Interface Rectangle
  Dessiner()
  Effacer()
EndInterface</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comme on veut obliger l’utilisateur à passer par l’<code>Interface</code>, il n’est plus question de créer un objet directement à partir de la Classe <code>Rectangle2</code>.</p>
</div>
<div class="paragraph">
<p>L’objet sera donc créée en écrivant :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect.Rectangle</code></pre>
</div>
</div>
<div class="paragraph">
<p>au lieu de <code>Rect.Rectangle2</code></p>
</div>
<div class="paragraph">
<p>Cependant, il ne faut pas oublier de relier l’<code>Interface</code> à la Classe.
Pour cela il faut initialiser l’objet <code>Rect</code> et il est conseillé de le faire lors de la déclaration de l’objet.</p>
</div>
<div class="paragraph">
<p>Correction faite, la bonne instruction pour déclarer l’objet via l’interface est la suivante :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect.Rectangle = New_Rect(0, 10, 0, 20)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>New_Rect()</code> est une fonction qui réalise l’opération d’initialisation.
Ce que l’on sait déjà d’elle, c’est qu’elle retourne comme valeur l’adresse mémoire contenant les adresses des fonctions utilisées par l’interface.</p>
</div>
<div class="paragraph">
<p>Voici maintenant le corps de la fonction <code>New_Rect()</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure New_Rect(x1.l, x2.l, y1.l, y2.l)
  *Rect.Rectangle2 = AllocateMemory(SizeOf(Rectangle2))

  *Rect\Dessiner = @Dessiner_Rectangle()
  *Rect\Effacer = @Effacer_Rectangle()

  *Rect\x1 = x1
  *Rect\x2 = x2
  *Rect\y1 = y1
  *Rect\y2 = y2

  ProcedureReturn *Rect
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette fonction alloue une zone mémoire de la taille de la Classe de l’objet.
Elle initialise ensuite les méthodes puis les attributs de l’objet.
Elle se termine en retournant l’adresse de cette zone mémoire.
Comme on trouve au début de cette zone mémoire d’abord les adresses des fonctions <code>Dessiner_Rectangle()</code> et <code>Effacer_Rectangle()</code>, on initialise effectivement l’interface.</p>
</div>
<div class="paragraph">
<p>Pour accéder aux méthodes de l’objet <code>Rect</code>, il suffit d’écrire :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect\Dessiner()
Rect\Effacer()</code></pre>
</div>
</div>
<div class="paragraph">
<p>On vérifie bien que :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>la Classe <code>Rectangle2</code> permet d’initialiser l’interface de l’objet.</p>
</li>
<li>
<p><code>Rect</code>, déclaré via l’interface, est un objet de la Classe <code>Rectangle2</code> pouvant utiliser les méthodes <code>Dessiner()</code> et <code>Effacer()</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nous avons donc réalisé, via l’<code>Interface</code> et la fonction <code>New_Rect()</code>, l’instanciation d’un objet Rect de la Classe <code>Rectangle2</code>.
La fonction <code>New_Rect()</code> est appelée <strong>Constructeur</strong> de l’objet de Classe <code>Rectangle2</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Toutes les implémentations des Méthodes (blocs <code>Procedur : EndProcedure</code>) doivent comporter comme premier argument le pointeur <code>*this</code> de l’objet sur lequel on doit appliquer la fonction.
A l’opposé, l’argument <code>*this</code> ne doit plus apparaît au niveau de l’<code>Interface</code>. En effet, comme l’instruction nous permet d’écrire <code>Rect\Dessiner()</code>, on sait que la méthode <code>Dessiner()</code> est celle de l’objet <code>Rect</code>: Il n’y a pas d’ambiguïté. Tout se passe comme si l’objet <code>Rect</code> était "conscient" de son état.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a id="admonition-constructeur-parametres"></a>Le constructeur pourrait recevoir comme paramètres supplémentaires, les adresses des fonctions implémentant les méthodes. Il n’en est rien ici car on connait l’implémentation des méthodes: c’est celle de la classe. Par contre on ne connait pas l’état initial que l’utilisateur veut donner à l’objet. Il se peut donc que le constructeur comporte des paramètres pour l’initialisation des attributs.
C’est le cas ici pour <code>New_Rect()</code> demandant en entrée les coordonnées (<code>x1</code>, <code>y1</code>) et (<code>x2</code>, <code>y2</code>) des points diamétralement opposés du rectangle.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="initialisation-d-objet"><a class="anchor" href="#initialisation-d-objet"></a>Initialisation d’Objet</h3>
<div class="paragraph">
<p>Nous avons vu que le constructeur, après avoir alloué la place mémoire nécessaire à l’objet, initialise les différents membres de l’objet (méthodes et attributs).
On peut isoler cette opération dans une procédure à part, que le constructeur appellera.
Cette précaution permet de distinguer l’allocation mémoire de l’initialisation de l’objet. Ceci sera très utile pour mener à bien par la suite le concept d’héritage, car une seule allocation de mémoire suffit, mais plusieurs initialisations seront nécessaires.</p>
</div>
<div class="paragraph">
<p>Cependant nous séparerons l’initialisation des méthodes et celle des attributs.
En effet, l’implémentation des méthodes dépend de la classe, alors que l’initialisation des attributs dépend de l’objet lui-même (voir <a href="#admonition-constructeur-parametres">remarque précédente</a>)</p>
</div>
<div class="paragraph">
<p>Dans notre exemple, nous écrirons les deux procédures suivantes :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Init_Mthds_Rect(*Rect.Rectangle2)
  *Rect\Dessiner = @Dessiner_Rectangle()
  *Rect\Effacer = @Effacer_Rectangle()
EndProcedure

Procedure Init_Mbers_Rect(*Rect.Rectangle2, x1.l, x2.l, y1.l, y2.l)
  *Rect\x1 = x1
  *Rect\x2 = x2
  *Rect\y1 = y1
  *Rect\y2 = y2
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>et le Constructeur devient:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure New_Rect(x1.l, x2.l, y1.l, y2.l)
  *Rect = AllocateMemory(SizeOf(Rectangle2))
  Init_Mthds_Rect(*Rect)
  Init_Mbers_Rect(*Rect, x1, x2, y1, y2)
  ProcedureReturn *Rect
EndProcedure</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="destructeur-d-objet"><a class="anchor" href="#destructeur-d-objet"></a>Destructeur d’Objet</h3>
<div class="paragraph">
<p>On associe toujours à un constructeur d’objet, son opposé : le destructeur d’objet.
Lors de la construction d’un objet, une zone mémoire a était allouée pour stocker les définitions des méthodes et des attributs.
Quant un objet n’est plus utile, il ne faut pas oublier de le détruire pour libérer la mémoire.
Ce processus se fait en utilisant une fonction appelée <strong>Destructeur</strong> d’objet.</p>
</div>
<div class="paragraph">
<p>Dans notre exemple d’objet de la Classe <code>Rectangle2</code>, le destructeur d’objet s’écrira :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Free_Rect(*Rect)
  FreeMemory(*Rect)
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>et s’utilisera, comme suite:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Free_Rect(Rect2)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On peut voir le Destructeur d’objet comme une méthode de l’objet. Mais pour éviter d’alourdir l’objet et garder une homogénéité avec le Constructeur, nous avons préféré le voir comme une fonction de la Classe.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Détruire un objet par son Destructeur, signifie que l’on libère la place mémoire contenant les informations de l’objet mais en aucun cas on ne détruit l’infrastructure de l’objet.
Aussi, dans notre exemple, après avoir fait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Free_Rect(Rect2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>on peut toujours réutiliser <code>Rect2</code> sans préciser à nouveau son type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect2 = New_Rect(0, 10, 0, 20)
Rect2\Dessiner()</code></pre>
</div>
</div>
<div class="paragraph">
<p>En effet, lorsque l’on réalise l’instanciation d’un objet, comme suite :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect2.Rectangle</code></pre>
</div>
</div>
<div class="paragraph">
<p>on crée un objet <code>Rect2</code> dont la durée de vie est assujettie aux mêmes règles que celles des variables car Rect2 est d’abord une variable : C’est une variable structurée continuant les pointeurs de fonctions des méthodes de l’objet.(voir aussi le rappel qui suit)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Petit rappel : La durée de vie d’une variable est liée à la durée de vie de la partie du programme où elle est déclarée :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si la variable est déclarée à l’intérieur d’une fonction, sa durée de vie sera liée à celle de la fonction, c’est à dire égale au temps d’utilisation de la fonction.</p>
</li>
<li>
<p>Si la variable est déclarée en dehors de toute fonction, c’est à dire dans le corps principal du programme, sa durée de vie est liée à celle du programme</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="allocations-m-moire"><a class="anchor" href="#allocations-m-moire"></a>Allocations Mémoire</h3>
<div class="paragraph">
<p>A chaque nouvelle instanciation, le constructeur doit allouer dynamiquement une place mémoire de la taille des informations décrivant l’objet.
Pour cela, le Constructeur peut utiliser la commande <code>AllocateMemory()</code>, associée à la commande <code>FreeMemory()</code> pour le Destructeur.</p>
</div>
<div class="paragraph">
<p>Mais cela peut être une toute autre commande d’allocation dynamique de mémoire.
Sous OS Windows, on peut passer directement par les API par exemple.</p>
</div>
<div class="paragraph">
<p>En standard, PureBasic propose les listes chaînées qui permettent aussi d’allouer dynamiquement de la mémoire.</p>
</div>
</div>
<div class="sect2">
<h3 id="encapsulation-2"><a class="anchor" href="#encapsulation-2"></a>Encapsulation</h3>
<div class="paragraph">
<p>Imaginons maintenant que l’on ne veuille donner à l’utilisateur seulement accès à la méthode <code>Dessiner()</code> de la Classe <code>Rectangle2</code>. On commencera par définir l’interface désirée :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Interface Rectangle
  Dessiner()
EndInterface</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instanciation du nouvel objet reste la même:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect.Rectangle = New_Rect()</code></pre>
</div>
</div>
<div class="paragraph">
<p>avec</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Init_Mthds_Rect(*Rect.Rectangle2)
  *Rect\Dessiner = @Dessiner_Rectangle()
  *Rect\Effacer = @Effacer_Rectangle()
EndProcedure

Procedure Init_Mbers_Rect(*Rect.Rectangle2, x1.l, x2.l, y1.l, y2.l)
  *Rect\x1 = x1
  *Rect\x2 = x2
  *Rect\y1 = y1
  *Rect\y2 = y2
EndProcedure

Procedure New_Rect(x1.l, x2.l, y1.l, y2.l)
  *Rect = AllocateMemory(SizeOf(Rectangle2))
  Init_Mthds_Rect(*Rect)
  Init_Mbers_Rect(*Rect, x1, x2, y1, y2)
  ProcedureReturn *Rect
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>car en effet, la première adresse de fonction est bien celle de la méthode <code>Dessiner()</code>.</p>
</div>
<div class="paragraph">
<p>Maintenant, imaginons que l’on veuille donner à l’utilisateur seulement accès à la méthode <code>Effacer()</code>. On commencera par définir l’interface suivante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Interface Rectangle
  Effacer()
EndInterface</code></pre>
</div>
</div>
<div class="paragraph">
<p>Par contre l’instanciation du nouvel objet ne peut utiliser le constructeur <code>New_Rect()</code>.
Dans le cas contraire, le résultat serait identique au cas précédent.</p>
</div>
<div class="paragraph">
<p>Il faut donc créer un nouveau constructeur capable de retourner l’adresse de fonction adaptée.</p>
</div>
<div class="paragraph">
<p>En voici un :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Init_Mthds_Rect2(*Rect.Rectangle2)
  *Rect\Dessiner = @Effacer_Rectangle()
  *Rect\Effacer = @Dessiner_Rectangle()
EndProcedure

Procedure Init_Mbers_Rect(*Rect.Rectangle2, x1.l, x2.l, y1.l, y2.l)
  *Rect\x1 = x1
  *Rect\x2 = x2
  *Rect\y1 = y1
  *Rect\y2 = y2
EndProcedure

Procedure New_Rect2(x1.l, x2.l, y1.l, y2.l)
  *Rect = AllocateMemory(SizeOf(Rectangle2))
  Init_Mthds_Rect2(*Rect)
  Init_Mbers_Rect(*Rect, x1, x2, y1, y2)
  ProcedureReturn *Rect
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vous constatez qu’il a suffit d’inverser les adresses de fonction dans l’initialisation des méthodes de la Classe.
Certes, ce n’est pas très élégant de devoir affecter au champ Dessin de la Structure <code>Rectangle2</code> l’adresse d’une toute autre fonction.
Si cela permet de conserver la même <code>Structure</code>, celle de la Classe, cela souligne aussi une chose :
Les noms des pointeurs de fonctions nous intéressent moins que leurs valeurs !
Pour gommer ce faux problème, il suffit de renommer les pointeurs de la Classe comme suite :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle2
  *Methode1
  *Methode2
  x1.l
  x2.l
  y1.l
  y2.l
EndStructure</code></pre>
</div>
</div>
<div class="paragraph">
<p>C’est l’Interface et le Constructeur qui donnent un sens à ces pointeurs :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>en leur donnant un nom (rôle de l’interface)</p>
</li>
<li>
<p>en leur affectant les adresses de fonctions adéquates (rôle du constructeur)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Malgré cette disposition concernent les noms des pointeurs de fonction, il reste bien plus pratique de conserver un nom explicite si l’on ne compte pas cacher les méthodes (ce qui est le plus courant). Cela permet de faire évoluer une Classe Mère sans retoucher à la numérotation des pointeurs des Classes Filles.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="h-ritage-2"><a class="anchor" href="#h-ritage-2"></a>Héritage</h3>
<div class="paragraph">
<p>Comme lors de notre première implémentation du concept d’héritage, nous allons profiter de la qualité qu’ont à la fois les instructions <code>Structure</code> et <code>Interface</code> d’être étendues grâce au mot-clé Extends.</p>
</div>
<div class="paragraph">
<p>Ainsi, nous passerons de la Classe <code>Rectangle1</code> possédant une seule méthode <code>Dessiner()</code>…</p>
</div>
<div class="listingblock">
<div class="title">Interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Interface Rect1
  Dessiner()
EndInterface</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Classe</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle1
  *Methode1
  x1.l
  x2.l
  y1.l
  y2.l
EndStructure

Procedure Dessiner_Rectangle(*this.Rectangle1)
  ; [ ...some code... ]
EndProcedure

Procedure Init_Mthds_Rect1(*Rect.Rectangle1)
  *Rect\Methode1 = @Dessiner_Rectangle()
EndProcedure</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Constructeur</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Init_Mbers_Rect1(*Rect.Rectangle1, x1.l, x2.l, y1.l, y2.l)
  *Rect\x1 = x1
  *Rect\x2 = x2
  *Rect\y1 = y1
  *Rect\y2 = y2
EndProcedure

Procedure New_Rect1(x1.l, x2.l, y1.l, y2.l)
  *Rect = AllocateMemory(SizeOf(Rectangle1))
  Init_Mthds_Rect1(*Rect)
  Init_Mbers_Rect1(*Rect, x1, x2, y1, y2)
  ProcedureReturn *Rect
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>…à la Classe <code>Rectangle2</code>, possédant 2 méthodes : <code>Dessiner()</code> et <code>Effacer()</code> en écrivant :</p>
</div>
<div class="listingblock">
<div class="title">Interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Interface Rect2 Extends Rect1
  Effacer()
EndInterface</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Classe</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle2 Extends Rectangle1
  *Methode2
EndStructure

Procedure Effacer_Rectangle(*this.Rectangle2)
  ; [ ...some code... ]
EndProcedure

Procedure Init_Mthds_Rect2(*Rect.Rectangle2)
  Init_Mthds_Rect1(*Rect)
  *Rect\Methode2 = @Effacer_Rectangle()
EndProcedure</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Constructeur</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Init_Mbers_Rect2(*Rect.Rectangle2, x1.l, x2.l, y1.l, y2.l)
  Init_Mbers_Rect1(*Rect, x1, x2, y1, y2)
EndProcedure

Procedure New_Rect2(x1.l, x2.l, y1.l, y2.l)
  *Rect = AllocateMemory(SizeOf(Rectangle2))
  Init_Mthds_Rect2(*Rect)
  Init_Mbers_Rect2(*Rect, x1, x2, y1, y2)
  ProcedureReturn *Rect
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Accomplir un héritage consiste non seulement à étendre l’<code>Interface</code> et la Classe mais aussi à adapter l’initialisation des méthodes et des attributs.
Les deux procédures <code>Init_Mthds_Rect2()</code> et <code>Init_Mbers_Rect2()</code> font appel respectivement à l’initialisation des méthodes et à l’initialisation des attributs de la Classe <code>Rectangle1</code> (<code>Init_Mthds_Rect1()</code> et <code>Init_Mbers_Rect1()</code>) et non au constructeur <code>New_Rect1()</code>.</p>
</div>
<div class="paragraph">
<p>En effet, il n’est pas question d’instancier un objet de la Classe Mère (<code>Rectangle1</code>) pour construire un objet de la Classe Fille (<code>Rectangle2</code>).
Il est question simplement d’hériter des méthodes et des attributs, ce à quoi contribue l’emploi des initialisations de la Classe Mère dans la Classe Fille.</p>
</div>
<div class="paragraph">
<p>D’autre part, on vérifie bien qu’en modifiant la Classe Mère (en ajoutant une méthode ou une variable), la Classe Fille bénéficie instantanément des changements.</p>
</div>
<div class="paragraph">
<p>L’héritage est-il pour autant correct? Non, car dans l’état actuel, il ne permet pas à l’objet de la Classe Fille (<code>Rectangle2</code>) d’utiliser la nouvelle méthode <code>Effacer()</code> !
Ceci tout simplement car le pointeur de fonction *Methode2 ne se trouve pas directement à la suite du pointeur de fonction <code>*Methode1</code>.</p>
</div>
<div class="paragraph">
<p>Si on explicite la Structure de la Classe <code>Rectangle2</code>, on a :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle2
  *Methode1
  x1.l
  x2.l
  y1.l
  y2.l
  *Methode2
EndStructure</code></pre>
</div>
</div>
<div class="paragraph">
<p>au lieu de disposer de la Structure ci-dessous, autorisant une initialisation correcte de l’interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle2
  *Methode1
  *Methode2
  x1.l
  x2.l
  y1.l
  y2.l
EndStructure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rappelez-vous qu’il faut des adresses de fonction qui se suivent et qui soient ordonnées à l’image de l’<code>Interface</code> (<a href="#admonition-structure-interface-symetrie">voir remarque précédente</a>)</p>
</div>
<div class="paragraph">
<p>On résout ce problème en regroupant dans une structure spécifique les méthodes entre-elles !
Il suffit alors que la Structure de la Classe garde un pointeur sur cette nouvelle structure comme le montre l’exemple suivant :</p>
</div>
<div class="listingblock">
<div class="title">Interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Interface Rect1
  Dessiner()
EndInterface</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Classe</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle1
  *Methodes
  x1.l
  x2.l
  y1.l
  y2.l
EndStructure

Procedure Dessiner_Rectangle(*this.Rectangle1)
  ; [ ...some code... ]
EndProcedure

Structure Mthds_Rect1
  *Methode1
EndStructure

Procedure Init_Mthds_Rect1(*Mthds.Mthds_Rect1)
  *Mthds\Methode1 = @Dessiner_Rectangle()
EndProcedure

Mthds_Rect1. Mthds_Rect1
Init_Mthds_Rect1(@Mthds_Rect1)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Constructeur</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Init_Mbers_Rect1(*Rect.Rectangle1, x1.l, x2.l, y1.l, y2.l)
  *Rect\x1 = x1
  *Rect\x2 = x2
  *Rect\y1 = y1
  *Rect\y2 = y2
EndProcedure

Procedure New_Rect1(x1.l, x2.l, y1.l, y2.l)
  Shared Mthds_Rect1
  *Rect.Rectangle1 = AllocateMemory(SizeOf(Rectangle1))
  *Rect\Methodes = @Mthds_Rect1
  Init_Mbers_Rect1(*Rect, x1, x2, y1, y3)
  ProcedureReturn *Rect
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>La structure <code>Mthds_Rect1</code> décrit tous les pointeurs de fonction des méthodes de la Classe.
S’en suit la déclaration de la variable <code>Mthds_Rect1</code> de type <code>Mthds_Rect1</code> ainsi que son initialisation grace à <code>Init_Mthds_Rect1()</code>.</p>
</div>
<div class="paragraph">
<p>La variable Mthds_Rect1 est appelée <strong>la table des méthodes</strong> de la class car elle contient l’ensemble des adresses des méthodes de la class.</p>
</div>
<div class="paragraph">
<p>Cet ensemble constitue la description complète des méthodes de la Classe.</p>
</div>
<div class="paragraph">
<p>La structure <code>Rectangle1</code>, comporte maintenant un pointeur <code>*Methodes</code>, initialisé par le constructeur en donnant l’adresse de la variable <code>Mthds_Rect1</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>L’expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Mthds_Rect1.Mthds_Rect1
Init_Mthds_Rect1(@Mthds_Rect1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>peut etre condensée en</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Init_Mthds_Rect1(@Mthds_Rect1.Mthds_Rect1)</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>L’héritage est alors possible car en étendant la <code>Structure</code> <code>Methd_Rect1</code> en une nouvelle <code>Methd_Rect2</code>, les adresses de fonction vont se suivre:</p>
</div>
<div class="listingblock">
<div class="title">Interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Interface Rect2 Extends Rect1
  Effacer()
EndInterface</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Classe</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rectangle2 Extends Rectangle1
EndStructure

Procedure Effacer_Rectangle(*this.Rectangle2)
  ; [ ...some code... ]
EndProcedure

Structure Mthds_Rect2 Extends Mthds_Rect1
  *Methode2
EndStructure

Procedure Init_Mthds_Rect2(*Mthds.Mthds_Rect2)
  Init_Mthds_Rect1(*Mthds)
  *Mthds\Methode2 = @Effacer_Rectangle()
EndProcedure

Mthds_Rect2. Mthds_Rect2
Init_Mthds_Rect2(@Mthds_Rect2)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Constructeur</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Init_Mbers_Rect2(*Rect.Rectangle2 , x1.l, x2.l, y1.l, y2.l)
  Init_Mbers_Rect1(*Rect, x1, x2, y1, y2)
EndProcedure

Procedure New_Rect2(x1.l, x2.l, y1.l, y2.l)
  Shared Mthds_Rect2
  *Rect.Rectangle2 = AllocateMemory(SizeOf(Rectangle2))
  *Rect\Methodes = @Mthds_Rect2
  Init_Mbers_Rect2(*Rect, x1, x2, y1, y2)
  ProcedureReturn *Rect
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dans cet exemple, la Structure <code>Rectangle2</code> est vide, ce qui n’est pas gênant en soit.
Deux raisons à cela :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>D’abord le pointeur <code>*Methodes</code> n’a besoin d’exister qu’une seule fois et ceci dans la Classe Mère.</p>
</li>
<li>
<p>Ensuite, nous n’avons pas souhaitez ajouter d’attributs supplémentaires, auquel cas elle aurait dû les contenir.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le fait d’avoir externalisé l’initialisation des méthodes hors du constructeur combiné à des pointeurs de fonctions disponiblent dans une variable fixe a trois avantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Les pointeurs de fonction des méthodes de la Classe sont initialisés une fois pour toute et non plus à chaque instanciation d’un objet</p>
</li>
<li>
<p>Les objets instanciés ne disposent plus que d’un pointeur vers les pointeurs des méthodes: le gain en place mémoire est substantiel.</p>
</li>
<li>
<p>Comme tous les objets pointent vers les mêmes pointeurs de fonction, cela garantit un comportement identique des objets de même Classe.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="accesseur-et-modifieur-d-objet"><a class="anchor" href="#accesseur-et-modifieur-d-objet"></a>Accesseur et Modifieur d’Objet</h3>
<div class="paragraph">
<p>En passant par l’<code>Interface</code>, il n’est possible de manipuler que des méthodes de l’objet.
L’interface encapsule donc entièrement les attributs des objets, c’est à dire qu’elle les cache.
Pour accéder aux attributs, soit pour les lires, soit pour les modifier, il faut donc disposer de méthodes spécifiques et les mettre à disposition de l’utilisateur.
Les méthodes qui permettent de lire les attributs d’un objet sont appelées les <strong>Accesseur</strong> de l’objet.
Les méthodes qui permettent de modifier les attributs d’un objet sont appelées les <strong>Modifieurs</strong> de l’objet.</p>
</div>
<div class="paragraph">
<p>Dans notre exemple de Classe <code>Rectangle1</code>, si nous voulons lire la valeur de l’attribut <code>var2</code>, on créera l’Accesseur suivant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Get_var2(*this.Rectangle1)
  ProcedureReturn *this\var2
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>De même, pour modifier la valeur de l’attribut <code>var2</code>, on écrira le Modifieur suivant</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Set_var2(*this.Rectangle1, value)
  *this\var2 = value
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comme les Accesseurs et les Modifieurs n’existent que pour permettre à l’utilisateur de modifier tout ou partie des attributs d’un objet, ils sont obligatoirement présents dans l’interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Voir l’annexe <a href="#optimisation-accesseurs-et-aux-modifieurs">Optimisation</a> du tutorial pour étudier de quelle manière on peut optimiser les performances des accesseurs et des modifieurs lors de l’exécution</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="synth-se-et-notation"><a class="anchor" href="#synth-se-et-notation"></a>Synthèse et notation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Avant d’aborder la suite, dans laquelle nous allons assoire notre implémentation d’un objet en PureBasic, je vous propose de faire une synthèse de tout ce qui vient d’etre vu. L’implémentation que nous venons de voir d’un objet se présente sous la forme suivante :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Une <strong>Interface</strong>,</p>
</li>
<li>
<p>Une <strong>Classe</strong> (concrète/abstraire) regroupant la définition des méthodes,</p>
</li>
<li>
<p>Un <strong>Constructeur</strong> muni d’une routine d’initialisation des attributs,</p>
</li>
<li>
<p>Un <strong>Destructeur</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le tableau suivant synthétise ce qu’est notre Objet en PureBasic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le mot <code>Classe</code> fait référence au nom de la Classe (ex : <code>Methd_Classe</code>)</p>
</li>
<li>
<p>Le mot <code>ClasseMere</code> fait référence au nom de la Classe Mère lors d’un héritage (ex : <code>Methd_ClasseMere</code>)</p>
</li>
<li>
<p>Les expressions entre accolades <code>{…}</code> sont à utiliser lors d’un héritage</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">Interface &lt;Interface&gt; {Extends &lt;InterfaceMere&gt;}
  Methode1()
  [Methode2()]
  [Methode3()]
  ...
EndInterface</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Classe</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">Structure &lt;Classe&gt; {Extends &lt;ClasseMere&gt;}
  *Methods
  [Attribut1]
  [Attribut2]
  ...
EndStructure

Procedure Methode1(*this.Classe, [arg1]…)
  ...
EndProcedure

Procedure Methode2(*this.Classe, [arg1]…)
  ...
EndProcedure
  ...

Structure &lt;Mthds_Classe&gt; {Extends &lt;Mthds_ClasseMere&gt;}
  *Method1
  *Method2
  ...
EndStructure

Procedure Init_Mthds_Classe(*Mthds.Mthds_Classe)
  {Init_Mthds_ClasseMere(*Mthds)}
  *Mthds\Method1 = @Methode1()
  *Mthds\Method2 = @Methode2()
  ...
EndProcedure

Mthds_Classe.Mthds_Classe
Init_Mthds_Classe(@Mthds_Classe)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Constructeur</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">Procedure Init_Mbers_Classe(*this.Classe, [var1]…)
  {Init_Mbers_ClasseMere(*this)}
  [*this\Attibut1 = var1]
  ...
EndProcedure

Procedure New_Classe([var1]…)
  Shared Mthds_Classe
  *this.Classe = AllocateMemory(SizeOf(Classe))
  *this\Methods = @Mthds_Classe
  Init_Mbers_Classe(*this, [var1]…)
  ProcedureReturn *this
EndProcedure</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Destructeur</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure Free_Classe(*this)
  FreeMemory(*this)
EndProcedure</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="premier-exemple-de-code"><a class="anchor" href="#premier-exemple-de-code"></a>Premier Exemple de Code</h3>
<div class="paragraph">
<p>Voici un exemple de code où l’héritage est utilisé:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="POO-Heritage-Ex1.pb"><code>POO-Heritage-Ex1.pb</code></a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="classe-pb"><a class="anchor" href="#classe-pb"></a>Classe PB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maintenant que nous avons vu les concepts objets et leurs possibles implémentations en PureBasic, il est grand temps de se fixer une implémentation.</p>
</div>
<div class="paragraph">
<p>Je vous propose ici l’implémentation qui me semble, à l’heure actuelle de mes connaissances, la plus adaptée à la programmation objet via PureBasic.</p>
</div>
<div class="paragraph">
<p>Elle s’appuie sur l’ensemble du travail exposé précédemment mais aussi de ma pratique du sujet.
L’autre objectif affiché est de tendre à simplifier l’utilisation des concepts objets, par la clarté des instructions et l’automatisation des opérations autant que possible.
Dans cette démarche les <a href="http://drac.site.chez-alice.fr/Tutorials%20Programming%20PureBasic/DirectivesCompilateur/DirectivesCompilateur_Macro.htm">macros</a> vont jouer un rôle décisif.
Grandement facilitée par les instructions Interface et Macro, l’implémentation proposée reste tout naturellement limitée par le langage lui-même.</p>
</div>
<div class="paragraph">
<p>Dans un premier temps, nous découvrirons les instructions d’une Classe en PureBasic. Puis nous analyserons ensemble ce qui se cache derrière en tirant des parallèles avec les pages précédentes pour terminer sur une discussion des choix adoptés.</p>
</div>
<div class="sect2">
<h3 id="classe-purebasic"><a class="anchor" href="#classe-purebasic"></a>Classe PureBasic</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">;Classe de l’objet
Class(&lt;ClassName&gt;)
  [Methode1()]
  [Methode2()]
  [Methode3()]
  ...
  Methods(&lt;ClassName&gt;)
    [&lt;*Methode1&gt;]
    [&lt;*Methode2&gt;]
    [&lt;*Methode3&gt;]
    ...
  Members(&lt;ClassName&gt;)
    [&lt;Attribut1&gt;]
    [&lt;Attribut2&gt;]
    ...
EndClass(&lt;ClassName&gt;)

; Méthodes de l’object (implémentation)
  Method(&lt;ClassName&gt;, Method1) [,&lt;variable1 [= DefaultValue]&gt;,...])
  ...
  [ProcedureReturn value]
EndMethod(&lt;ClassName&gt;, Method1)

; ...(idem pour déclarer chaque methode)

; Constructeur de l’objet
New(&lt;ClassName&gt;)
  ...
EndNew

; Destructeur de l’objet
Free(&lt;ClassName&gt;)
  ...
EndFree</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comme on peut le voir, la Classe PureBasic s’articule autour de quatre grands thèmes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La définition de la classe via l’instruction <code>Class : EndClass</code>.</p>
</li>
<li>
<p>L’implémentation des méthodes de la classe via l’instruction <code>Method : EndMethod</code>.</p>
</li>
<li>
<p>La construction de l’objet avec le constructeur <code>New : EndNew</code>.</p>
</li>
<li>
<p>La destructeur de l’objet avec le destructeur <code>Free : EndFree</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="deuxi-me-exemple-de-code"><a class="anchor" href="#deuxi-me-exemple-de-code"></a>Deuxième Exemple de Code</h3>
<div class="paragraph">
<p>Vous trouverez ici le fichier comportant la déclaration de ce jeu d’instructions ainsi qu’un exemple d’utilisation basé sur <a href="#premier-exemple-de-code">l’exemple d’héritage précédent</a>, ce qui vous permettra de comparer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="POO.pbi"><code>POO.pbi</code></a></p>
</li>
<li>
<p><a href="POO-Heritage-Ex2.pb"><code>POO-Heritage-Ex2.pb</code></a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si vous avez jetté un coup d’oeil au source <a href="POO.pbi"><code>POO.pbi</code></a>, vous aurez remarqué que l’implémentation finale est légèrement plus compliquée que ce qui est exposé ici. Cela s’explique par quelques dispositions prises dans le source pour maintenir plus facilement le code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Passons en revue maintenant cette Classe Purebasic…</p>
</div>
</div>
<div class="sect2">
<h3 id="class-endclass"><a class="anchor" href="#class-endclass"></a>Class : EndClass</h3>
<div class="paragraph">
<p>L’instruction <code>Class : EndClass</code> permet de déclarer trois types de composantes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>L’<strong>interface</strong> de l’objet, seule partie —rappelons le— que l’utilisateur peut manipuler.</p>
</li>
<li>
<p>Les <strong>méthodes</strong> de l’objet hors implémentation qui se réduisent aux seuls pointeurs des méthodes.</p>
</li>
<li>
<p>Les <strong>membres</strong> (hors méthodes) de l’objet. Par la suite, de fait, les mots «<strong>membre</strong>» et plus correctement «<strong>attribut</strong>» feront souvent référence à ces seuls éléments (et non aux méthodes qui sont aussi des membres de l’objet au sens strict).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">; Classe de l’objet
Class(&lt;ClassName&gt;)
  [Methode1()]
  [Methode2()]
  [Methode3()]
  ...
  Methods(&lt;ClassName&gt;)
    [&lt;*Methode1&gt;]
    [&lt;*Methode2&gt;]
    [&lt;*Methode3&gt;]
    ...
  Members(&lt;ClassName&gt;)
    [&lt;Attribut1&gt;]
    [&lt;Attribut2&gt;]
    ...
EndClass(&lt;ClassName&gt;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque composante est clairement identifiée par les mots clés <code>Class</code>/<code>Methods</code>/<code>Members</code>. Cet ordre doit être respecté et les mots clés doivent toujours figurer même si aucune méthode ou aucun membre ne sera déclaré. De même, à chaque fois le nom de la classe se doit d’apparaître entre parenthèses.</p>
</div>
<div class="paragraph">
<p>L’explication trouve son origine dans la définition de chaque mot clé dont voici le code:</p>
</div>
<div class="sect3">
<h4 id="instruction-class"><a class="anchor" href="#instruction-class"></a>Instruction Class</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro Class(ClassName)
  ; Declare the class interface
  Interface ClassName#_
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>Class</code> se limite à l’entête de la déclaration de l’interface avec pour nom d’interface celui de la classe suivi de “<code>_</code>”. Ce qui suit l’instruction <code>Class</code> sera donc la définition de l’interface de l’objet.</p>
</div>
</div>
<div class="sect3">
<h4 id="instruction-methods"><a class="anchor" href="#instruction-methods"></a>Instruction Methods</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro Methods(ClassName)
  EndInterface
  ; Declare the method-table structure
  Structure Mthds_#ClassName
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>Methods</code> commence par fermer la définition de l’interface avec l’instruction <code>EndInterface</code>. Puis elle débute la déclaration de la structure qui définit les pointeurs des méthodes.</p>
</div>
</div>
<div class="sect3">
<h4 id="instruction-members"><a class="anchor" href="#instruction-members"></a>Instruction Members</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro Members(ClassName)
  EndStructure
  ; Create the method-table
  Mthds_#ClassName.Mthds_#ClassName
  ; Declare the members
  ; No parent class: implement pointers for the Methods and the instance
  Structure Mbrs_#ClassName
    *Methods
    *Instance.ClassName
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>Members</code> est plus compliquée que les deux précédentes.</p>
</div>
<div class="paragraph">
<p>Elle commence par fermer la définition de la structure précédemment ouverte par l’instruction Methods. Ensuite elle déclare tout naturellement la table des methodes basée sur la structure fraîchement acquise. Pour l’instant cette table est vide et se remplira au fur et à mesure de la déclaration des méthodes. Nous aborderons cela plus loin (<a href="#instruction-endmethod">j’peux pas attendre</a>).</p>
</div>
<div class="paragraph">
<p>Enfin l’instruction <code>Members</code> se termine en ouvrant la déclaration de la structure qui définit les membres de l’objet. On trouve en début —comme il convient— le pointeur porteur de l’adresse de la table des méthodes de l’objet, c.a.d celle de la variable juste au-dessus. Rappelons que c’est le constructeur qui initialisera le tout. Puis nous trouvons un autre pointeur qui contiendra l’adresse de l’objet lui-même. J’expliquerai plus tard la raison de ce nouveau membre (<a href="#admonition-on-objet-toujours-pointeur">non! maintenant</a>).</p>
</div>
<div class="paragraph">
<p>Il reste simplement pour l’utilisateur qu’à déclarer les autres membres de l’objet à la suite de l’instruction <code>Members</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="instruction-endclass"><a class="anchor" href="#instruction-endclass"></a>Instruction EndClass</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro EndClass(ClassName)
  EndStructure

  Structure ClassName
    StructureUnion
      *Md.ClassName#_     ; les méthodes
      *Mb.Mbrs_#ClassName ; les membres
    EndStructureUnion
  EndStructure
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>EndClass</code> est à l’origine du choix d’implémentation de notre objet. Nous allons donc nous attarder à la décrire correctement.</p>
</div>
<div class="paragraph">
<p>Comme pour <code>Methods</code> et <code>Members</code>, elle commence par fermer ce qui a été ouvert par l’instruction précédente, ici la structure décrivant les membres de l’objet.</p>
</div>
<div class="paragraph">
<p>Ensuite, nous trouvons la structure qui porte le nom de la classe et qui servira donc à l’utilisateur pour déclarer son objet.</p>
</div>
<div class="paragraph">
<p>Cette structure est en fait l’union de deux éléments:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Le premier est un pointeur typé par l’interface qui permet d’appeler les méthodes de l’objet.</p>
</li>
<li>
<p>Le second est un pointeur typé par la structure définissant les membres. Il sert à accéder aux membres de l’objet.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Cette architecture met en pratique l’optimisation sur les accesseurs d’un objet exposée en <a href="#optimisation-accesseurs-et-aux-modifieurs">annexe</a>. L’intérêt de ce choix est double:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Il permet à l’utilisateur d’appliquer un même processus pour accéder aux méthodes et aux membres d’un objet.</p>
<div class="paragraph">
<p>Pour accéder à une méthode, il suffira d’écrire:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">*Rect\Md\Dessiner()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour accéder à un attribut, il suffira d’écrire:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">*Rect\Mb\var1</code></pre>
</div>
</div>
</li>
<li>
<p>Il évite à l’utilisateur de déclarer systématiquement les accesseurs/modifieurs de l’objet lorsque ceux-ci sont triviaux. Le gain en temps et en commodité est des plus appréciable. On limite du même coup le recourt à des méthodes (petite optimisation).</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En contre partie de ce choix, tous les membres d’un objet sont visibles par l’utilisateur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Il est possible d’agrémenter un peu cette structure. Comme les termes “<code>Md</code>” et “<code>Mb</code>” sont visuellement très proches on peut être tenté de mieux les distinguer. Bien que ce choix n’ai pas été retenu, voici une possibilité intéressante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure ClassName
  StructureUnion
    *Md.ClassName#_       ; les méthodes
    *Get.Mbrs_#ClassName  ; utilisé pour lire un membre
    *Set.Mbrs_#ClassName  ; utilisé pour modifier un menbre
  EndStructureUnion
EndStructure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ici, le pointeur <code>*Mb</code> a été remplacé par deux pointeurs <code>*Get</code> et <code>*Set</code>. Bien que servant à la même chose, ils peuvent rendre le code plus lisible en précisant si l’on veut lire ou modifier la valeur d’un attribut.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="method-endmethod"><a class="anchor" href="#method-endmethod"></a>Method : EndMethod</h3>
<div class="paragraph">
<p>L’instruction <code>Method : EndMethod</code> permet de réaliser l’implémentation des différentes méthodes de l’objet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">; Méthodes de l’object (implémentation)
Method(&lt;ClassName&gt;, Method1) [,&lt;variable1 [= DefaultValue]&gt;,...])
  ...
  [ProcedureReturn value]
EndMethod(&lt;ClassName&gt;, Method1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque mot clé est suivi du nom de la classe et du nom de la méthode.</p>
</div>
<div class="paragraph">
<p>A l’usage, cette instruction se travaille comme l’instruction <code>Procedure : EndProcedure</code>. Nous allons voir qu’il s’agit là d’un habillage ce cette instruction.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notez la syntaxe très particulière des méthodes qui nécessite deux parenthèses fermées. Cette spécificité vient de l’utilisation d’une macro combinée à un nombre variable d’arguments possible pour chaque méthode.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="instruction-method"><a class="anchor" href="#instruction-method"></a>Instruction Method</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro Method(ClassName, Mthd)
  Procedure Mthd#_#ClassName(*this.Mbrs_#ClassName
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>Method</code> n’est rien d’autre que l’instruction <code>Procedure</code> à laquelle on aura pris soin de déclarer la variable <code>*this</code> exigée en début d’arguments.</p>
</div>
<div class="paragraph">
<p>Le code ne se termine pas par une parenthèse afin de permette à l’utilisateur de compléter par les paramètres spécifiques de sa méthode. A lui de fermer cette parenthèse comme la syntaxe le montre, sinon le compilateur ne manquera pas de le signaler!</p>
</div>
</div>
<div class="sect3">
<h4 id="instruction-endmethod"><a class="anchor" href="#instruction-endmethod"></a>Instruction EndMethod</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro EndMethod(ClassName, Mthd)
  EndProcedure
  ; Save the method’s address into the method-table
  Mthds_#ClassName\Mthd=@Mthd#_#ClassName()
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>EndMethod</code> commence par fermer la procédure ouverte par l’instruction <code>Method</code>.
Maintenant que la méthode est définie, on peut la référencer dans la <strong>table des méthodes</strong> déclarée lors du mot clé Members de la classe. De fait, déclarer une méthode revient aussi à la référencer automatiquement.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="le-constructeur-de-l-objet"><a class="anchor" href="#le-constructeur-de-l-objet"></a>Le constructeur de l’objet</h3>
<div class="paragraph">
<p>L’instruction <code>New : EndNew</code> permet d’instancier et d’initialiser un objet de la classe.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">; Constructeur de l’objet
New(&lt;ClassName&gt;)
  ...
EndNew</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le mots clé <code>New</code> exige le nom de la classe comme paramètre.</p>
</div>
<div class="sect3">
<h4 id="instruction-new"><a class="anchor" href="#instruction-new"></a>Instruction New</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro New(ClassName)
  Declare Init_Mbers_#ClassName(*this, *input.Mbrs_#ClassName=0)

  Procedure.l New_#ClassName(*input.Mbrs_#ClassName =0)
    Shared Mthds_#ClassName
    ; Réserve la place mémoire nécéssaire à l’objet
    *this.Mbrs_#ClassName = AllocateMemory(SizeOf(Mbrs_#ClassName))
    ; Lui attache la table des méthodes
    *this\Methods=@Mthds_#ClassName
    ; L’objet est d’abord crée puis initialisé
    ; Crée l’objet
    *this\Instance= AllocateMemory(SizeOf(ClassName))
    *this\Instance\Md = *this
    ; Inititialise l’objet
    Init_Mbers_#ClassName(*this, *input)
    ProcedureReturn *this\Instance
  EndProcedure

  Init_Mbers(ClassName)
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>New</code> est dense mais ne change pas vraiment par rapport à la structuration vue auparavant.</p>
</div>
<div class="paragraph">
<p>Le but de ce mot clé est de créer un nouvel objet et de l’initialiser. L’ensemble de ces taches est réalisé au sein de la procédure <code>New_ClassName</code> qui est l’essentiel de la commande New.</p>
</div>
<div class="paragraph">
<p>Cette procédure accepte un seul argument, celui nécessaire à l’instruction <code>Init_Mbers</code> pour initialiser les attributs de l’objet.</p>
</div>
<div class="paragraph">
<p>Elle commence par réserver la place mémoire requise par les membres de l’objet.</p>
</div>
<div class="paragraph">
<p>Puis elle y attache la table des méthodes de la classe.</p>
</div>
<div class="paragraph">
<p>Elle s’attaque alors à l’instanciation de l’objet en attribuant une adresse à l’objet et en initialisant l’interface.</p>
</div>
<div class="paragraph">
<p>Vient alors l’initialisation des attributs de l’objet via la méthode <code>Init_Mbers</code>.</p>
</div>
<div class="paragraph">
<p>Et pour finir, l’instruction retourne l’adresse de l’objet.</p>
</div>
<div class="paragraph">
<p>L’astruce de cette macro réside dans la déclaration de <code>Init_Mbers</code> en toute fin. De la sorte, tout ce que l’utilisateur aura à ajouter à l’intérieur du block <code>New : EndNew</code> se limitera à l’initialisation des attributs. Cet aspect sera abordé plus en détail dans un moment(<a href="#l-instruction-priv-e-init_mbers-endinit_mbers">Où ça? Où ça?</a>).</p>
</div>
<div class="paragraph">
<p>Ceci est rendu possible en declarant la method <code>Init_Mbers</code> en début de macro.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On peut remarquer que la procedure <code>New_ClassName</code> est générique quelque soit la classe. Ceci s’explique car la partie qui varie (et donc spécifique à l’objet), est déportée hors de la procédure dans la methode <code>Init_Mbers</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="instruction-endnew"><a class="anchor" href="#instruction-endnew"></a>Instruction EndNew</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro EndNew
  EndInit_Mbers
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>EndNew</code> se limite à l’appel de l’instruction <code>EndInit_Mbers</code> qui termine la déclaration des attributs débutée par l’instruction New.</p>
</div>
<div class="paragraph">
<p>Conclusion: l’objectif est atteint. l’instruction <code>New : EndNew</code> permet bien de créer un nouvel objet initialisé.</p>
</div>
<div class="paragraph">
<p>A l’usage, l’instruction <code>New : EndNew</code> permettra d’initialiser les attributs d’un objet comme suite:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">New(Rect1)
  *this\var1 = *input\var1
  *this\var2 = *input\var2
  ; [ ...some code... ]
EndNew</code></pre>
</div>
</div>
<div class="paragraph">
<p>l’instanciation d’un objet par l’utilisateur se fera alors ainsi:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">input.Mbrs_Rect1
input\var1 = 10
input\var2 = 20

; *Rect est un nouvel objet de la classe Rect1
*Rect.Rect1 = New_Rect1(input)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notez que l’on appelle le constructeur par <code>New</code> suivi du nom de la classe séparé par “<code>_</code>”.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a id="admonition-on-objet-toujours-pointeur"></a>Par rapport à ce qui a été étudié jusqu’à présent, l’objet sera toujours un pointeur (car recevant une adresse). Loin d’etre gênant, cela s’explique par le choix fait de regrouper l’accès des méthodes et des membres (<a href="#instruction-endclass">Quoi!? J’me rappelle pas…</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a id="admonition-sur-this-instance"></a>C’est ce même choix qui requis deux allocations mémoire distinctes: celle des membres et celle pour le regroupent des méthodes et des membres (4 octets ici).
Cette bivalence qui n’existait pas lors de l’implémentation précédente, nous conduit à conserver cette information dans l’objet lui-même. Ainsi dans les méthodes de l’objet, vous aurait accès à l’adresse des membres avec <code>*this</code> et à l’adresse de l’instance (méthode et membres) par <code>*this\Instance</code>.</p>
</div>
<div class="paragraph">
<p>Une des conséquences importante est la possibilité d’utiliser <code>*this\Instance</code> pour appeler les méthodes de l’objet au sein même de ses méthodes (<em>Non je n’ai pas bu</em>!). Cette fonctionnalité est la meilleure manière pour y parvenir car on n’a pas a connaître le nom de la procédure présente derrière la méthode, ce qui est essentiel dans le processus d’héritage.</p>
</div>
<div class="paragraph">
<p>A cet effet, une macro <code>Mtd</code> est proposée dans le source <a href="POO.pbi"><code>POO.pbi</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="l-instruction-priv-e-init_mbers-endinit_mbers"><a class="anchor" href="#l-instruction-priv-e-init_mbers-endinit_mbers"></a>L’instruction privée Init_Mbers : EndInit_Mbers</h4>
<div class="paragraph">
<p>L’instruction <code>Init_Mbers : EndInit_Mbers</code> est une instruction privée que seul l’instruction <code>New : EndNew</code> va utiliser. Néanmoins, il est interessant de présenter cette instruction pour bien comprend comment procéder à l’initialisation d’un objet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">; Initialisation de l’objet
Init_Mbers(&lt;ClassName&gt;)
  ...
EndInit_Mbers</code></pre>
</div>
</div>
<div class="paragraph">
<p>On trouvera donc entre les deux mots clés une série d’initialisation de membres.
Notez que seul <code>Init_Mbers</code> est suivi du nom de la classe.</p>
</div>
<div class="sect5">
<h6 id="instruction-init_mbers"><a class="anchor" href="#instruction-init_mbers"></a>Instruction Init_Mbers</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro Init_Mbers(ClassName)
  Method(ClassName, Init_Mbers), *input.Mbrs_#ClassName =0)
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>Init_Mbers</code> est définie comme une méthode de l’objet acceptant un seul argument.</p>
</div>
<div class="paragraph">
<p>Afin d’initialiser l’objet en fonction des souhaits de l’utilisateur et ne sachant pas à l’avance le nombre de membres, le choix c’est porté sur un passage de l’information par référent.</p>
</div>
<div class="paragraph">
<p>Ce choix s’explique aussi par le parti pris que le constructeur à la responsabilité d’initialiser l’objet.
Enfin, et non des moindres, cette disposition permet d’automatiser la tache lors du processus d’héritage.</p>
</div>
<div class="paragraph">
<p>A l’usage, l’initialisation de membres ressemblera le plus souvent à ce qui suit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Init_Mbers(Rect1)
  *this\var1 = *input\var1
  *this\var2 = *input\var2
  ; [ ...some code... ]
EndInit_Mbers</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="instruction-endinit_mbers"><a class="anchor" href="#instruction-endinit_mbers"></a>Instruction EndInit_Mbers</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro EndInit_Mbers
  EndProcedure
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>EndInit_Mbers</code> est ni plus ni moins que l’instruction <code>EndProcedure</code> qui termine la déclaration de la méthode d’initialisation de l’objet</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Dans le code source final <a href="POO.pbi"><code>POO.pbi</code></a>, l’instruction <code>Init_Mbers : EndInit_Mbers</code> comporte des arguments falcutatifs supplémentaires appelés <code>arg1</code> à <code>arg5</code>. Dans certaines situations, il peut être utile de faire appel à ces arguments pour compléter les données d’entrées du pointeur <code>*input</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="destructeur-de-l-objet"><a class="anchor" href="#destructeur-de-l-objet"></a>Destructeur de l’objet</h3>
<div class="paragraph">
<p>L’instruction <code>Free : EndFree</code> permet de détruire un objet de la classe afin de restituer la mémoire allouée.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">; Destructeur de l’objet
Free(&lt;ClassName&gt;)
 ...
EndFree</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>Free</code> exige le nom de la classe en paramètre.</p>
</div>
<div class="sect4">
<h5 id="instruction-free-endfree"><a class="anchor" href="#instruction-free-endfree"></a>Instruction Free : EndFree</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Macro Free(ClassName)
  Procedure Free_#ClassName(*Instance.ClassName)
    If *Instance
EndMacro

Macro EndFree
      FreeMemory(*Instance\Md)
      FreeMemory(*Instance)
    EndIf
  EndProcedure
EndMacro</code></pre>
</div>
</div>
<div class="paragraph">
<p>L’instruction <code>Free : EndFree</code> est assez simple:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Free</code> ouvre une procédure avec pour argument l’adresse de l’objet. On vérifie au passage que l’adresse est non nulle (cela ne garanti malheireusement pas une adresse valide pour <code>FreeMemory</code>).</p>
</li>
<li>
<p><code>EndFree</code> libère dans l’ordre la zone mémoire allouée aux membres puis celle de l’objet.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A l’usage, la destruction d’un objet se fait ainsi:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Free_Rect1(*Rect)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comme pour le constructeur, notez bien que l’on appelle le destructeur par <code>Free</code> suivi du nom de la classe séparé par “<code>_</code>”.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si votre objet se compose d’autres objets, c.a.d que des objets sont des membres de l’objet en question et qu’ils existent par cet objet (<em>hic</em>!), il est important de les détruire en appelant leurs destructeurs entre les mots clés <code>Free</code> et <code>EndFree</code>.</p>
</div>
<div class="paragraph">
<p>Bien que PureBasic se charge de restituer toute mémoire utilisée, cela se produira uniquement une fois le programme terminé. Au court de l’exécution du programme, c’est à l’utilisateur de veiller aux grains pour éviter toute gourmandise binaire.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="h-ritage-3"><a class="anchor" href="#h-ritage-3"></a>Héritage</h3>
<div class="paragraph">
<p>Dans l’ensemble des commandes qui vient d’être exposé rien ne fait référence au processus d’héritage. Et c’est normal, puisque les instructions présentées ne le permettent pas et ne le peuvent pas (<em>Moua ! l’angoisse !</em>) ! Il est nécessaire de décliner un jeu d’instructions complémentaire pour traiter ce concept(<em>Arghhh ! Mega angoisse</em>).</p>
</div>
<div class="paragraph">
<p>Fort heureusement, il y a peu d’effort à fournir pour y parvenir puisque notre conception y est préparée (<em>Ouf ! Ca va mieux</em>).</p>
</div>
<div class="paragraph">
<p>Voici donc à quoi ressemble la classe dans ce cas de figure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic pseudocode" data-lang="purebasic pseudocode">; Classe de l’objet
ClassEx(&lt;ClassName&gt;,&lt;ParentClass&gt;)
  [Method1()]
  [Method2()]
  [Method3()]
  ...
  MethodsEx(&lt;ClassName&gt;,&lt;ParentClass&gt;)
    [&lt;*Method1&gt;]
    [&lt;*Method2&gt;]
    [&lt;*Method3&gt;]
    ...
  MembersEx(&lt;ClassName&gt;,&lt;ParentClass&gt;)
    [&lt;Attribute1&gt;]
    [&lt;Attribute2&gt;]
    ...
EndClass(&lt;ClassName&gt;)

; Méthodes de l’object (implémentation)
Method(&lt;ClassName&gt;, Method1) [,&lt;variable1 [= DefaultValue]&gt;,...])
  ...
  [ProcedureReturn value]
EndMethod(&lt;ClassName&gt;, Method1)

; ...(idem pour déclarer chaque méthode)...

; Constructeur de l’objet
NewEx(&lt;ClassName&gt;,&lt;ParentClass&gt;)
  ...
EndNew

; Destructeur de l’objet
Free(&lt;ClassName&gt;)
  ...
EndFree</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quatre nouvelles instructions font leur apparition: <code>ClassEx</code>, <code>MethodsEx</code>, <code>MembersEx</code> et <code>NewEx</code> en remplacement de <code>Class</code>, <code>Methods</code>, <code>Members</code> et <code>New</code>.</p>
</div>
<div class="paragraph">
<p>Pour chacune d’elle, en plus du nom de la classe, doit être précisé le nom de la classe mère.</p>
</div>
<div class="paragraph">
<p>L’opération est finalement assez simple pour l’utilisateur rendant le processus d’héritage très facile d’accès.</p>
</div>
<div class="paragraph">
<p>Je vous laisse le soin d’aller regarder le code pour analyser comment cela a été implémenté (<a href="POO.pbi"><code>POO.pbi</code></a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="discussion"><a class="anchor" href="#discussion"></a>Discussion</h3>
<div class="paragraph">
<p>Ouf! la présentation d’une Classe PureBasic est terminée.</p>
</div>
<div class="paragraph">
<p>Que peut-on en dire? Déjà, les macros ont permis de définir un jeu d’instructions permettant de:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clarifier la structure d’un objet</p>
</li>
<li>
<p>Faciliter voir d’automatiser certaines taches, comme l’initialisation des méthodes ou l’héritage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Je liste ici les choix de conception qui conduisent à la spécificité de l’objet. Comme nous allons le voir, il est possible d’en adapter certains pour vous approprier l’objet sans fondamentalement le modifier:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Utilisation d’une structure d’union pour définir l’objet. Cela lui confère la particularité de pouvoir accéder aux membres sans générer obligatoirement un accesseur.</p>
</li>
<li>
<p>La <strong>table des méthodes</strong> est propre à la classe et non à l’objet.</p>
<div class="ulist">
<ul>
<li>
<p>Elle est initialisée une fois pour toute et non plus à chaque instanciation d’un objet,</p>
</li>
<li>
<p>Les objets instanciés ne disposent que d’un pointeur vers la <strong>table des méthodes</strong>: le gain en place mémoire est substantiel,</p>
</li>
<li>
<p>Tous les objets pointent vers la même <strong>table des méthodes</strong>, cela garantit un comportement identique des objets de même Classe.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Un constructeur qui initialise l’objet, conduisant à utiliser un seul paramètre d’entré par référent pour passer les valeurs d’initialisation de l’objet. Le processus d’héritage en est grandement facilité.
Hors, on peut tout à fait imaginer créer un objet, puis que l’utilisateur appelle lui-même la routine d’initialisation: auquel cas, la méthode <code>Init_Mbers</code> n’est plus appelée par New et peut de ce fait comporter un nombre d’arguments quelconque. J’y vois au moins deux inconvénients:</p>
<div class="ulist">
<ul>
<li>
<p>Le risque d’une initialisation incorrecte de l’objet: on peut oublier de faire cet appel, mais surtout il n’est plus possible d’automatiser le processus d’héritage: c’est à l’utilisateur de le gérer!</p>
</li>
<li>
<p>Une forte interdépendance entre classe mère et classe fille : dès que les paramètres d’entrée de la méthode d’initialisation changent pour la classe mère, l’utilisateur doit procéder à cette modification dans toutes les classes filles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Malgré tout cette disposition ne change pas fondamentalement notre objet.A l’extrême, mais je le déconseille fortement, on peut imaginer que l’utilisateur initialise membre après membre en utilisant les accesseurs. Mais initialiser les membres d’un objet ne se limite pas toujours à une opération d’affectation. Elle peut nécessiter d’autres opérations internes plus complexes pour y parvenir. Si cela doit être répété à chaque nouvel objet, il est vivement conseillé de conserver une méthode dédiée.</p>
</div>
</li>
<li>
<p>Un destructeur homogène avec le constructeur. Il ne fait pas partie de l’interface bien que cela soit envisageable. Dans le cas contraire on écrirait <code>Objet\Md\Free()</code> au lieu d’écrire <code>Free_ClassName(Objet)</code>. Cette disposition est aisée à opérer et ne modifie en rien la conception de l’objet.</p>
</li>
<li>
<p>Je ne suis pas arrivé à automatiser la génération de la <strong>table des méthodes</strong>. Il est important de rappeler ici pourquoi elle s’articule autour d’une structure. La structure permet de créer des classes abstraites, c’est à dire des classes où toutes les méthodes ne sont pas implémentées. C’est une notion très important de la conception objet et on respecte ainsi l’ordre des adresses dans la table quelque soient les méthodes implémentées de la classe tout en s’accordant avec le processus d’héritage. Utiliser un tableau, une liste chaînée ou une table de hâchage en remplacement d’une structure n’aurai pas cette souplesse (du moins je ne l’ai pas trouvé).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="rappel-des-types"><a class="anchor" href="#rappel-des-types"></a>Rappel des types</h3>
<div class="paragraph">
<p>Vous trouverez ici la liste des types qu’utilise une classe:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">S’applique à</th>
<th class="tableblock halign-left valign-top">Origine</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mbrs_&lt;ClassName&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La Structure des membrese</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndClass</code></p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;ClassName&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’objet instancié</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;ClassName&gt;_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Class</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mthds_&lt;ClassName&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La table des méthodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Methods</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mbrs_&lt;ClassName&gt;_</code> <span class="icon red"><i class="fa fa-warning"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La Structure des membres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Members</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>Mbrs_&lt;ClassName&gt;_</code> n’a pas été présenté dans cet article. Il s’agit d’une étape intermédiaire utilisée pour construire la structure des membres <code>Mbrs_&lt;ClassName&gt;</code>. Cette disposition permet de réaliser la fonctionnalité <code>*this\Instance</code> <a href="#admonition-sur-this-instance">exposée ici</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion-2"><a class="anchor" href="#conclusion-2"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vous l’aurez compris, s’il est possible d’adopter une Programmation Orientée Objet en PureBasic, celle-ci demande un peu de rigeur d’écriture.
Mais une fois acquitté de cette tâche, la manipulation de l’objet est excessivement simple.</p>
</div>
<div class="paragraph">
<p>Or si les langages Objets apportent une plus grande souplesse dans l’ écriture de son code (via l’application des concepts objets), nous avons vu qu’elle favorise la multiplication de méthodes produisant un exécutable souvent plus imposant et pouvant perdre ainsi en performance pure.</p>
</div>
<div class="paragraph">
<p>Néanmoins, j’espère que ce tutorial vous aura permis de saisir les mécanismes sous-jacents à la POO et d’en comprendre les concepts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="optimisations"><a class="anchor" href="#optimisations"></a>Annexe A: Optimisations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les paragraphes qui suivent, traitent de considérations possibles à adopter afin d’améliorer, lors de l’exécution du programme, les performances de notre approche Orientée Objet.</p>
</div>
<div class="sect2">
<h3 id="optimisation-accesseurs-et-aux-modifieurs"><a class="anchor" href="#optimisation-accesseurs-et-aux-modifieurs"></a>Optimisation: Accesseurs et aux Modifieurs:</h3>
<div class="paragraph">
<p>Si on est amené à faire de nombreux appels aux Accesseurs et aux Modifieurs, cela revient à faire de nombreux appels de fonction, d’où une perte de performance.
Pour ceux qui sont en quête de performance, il y a deux possibilités pour accélérer le processus :</p>
</div>
<div class="paragraph">
<p>Tous deux consistent à jumeler un pointeur à l’objet instancié, la deuxième solution étant un habillage de la première.</p>
</div>
<div class="sect3">
<h4 id="premi-re-solution"><a class="anchor" href="#premi-re-solution"></a>Première solution :</h4>
<div class="paragraph">
<p>Le pointeur en question sera typé de la <code>Structure</code> de la Classe.
Ainsi pour un objet <code>Rect</code> de la Classe <code>Rectangle1</code>, nous pouvons écrire :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect.Rect = New_Rect()
*Rect.Rectangle1 = Rect</code></pre>
</div>
</div>
<div class="paragraph">
<p>On accède ainsi à l’attribut var2 en écrivant :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">*Rect\var2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il est alors possible de le lire comme de le modifier.
C’est la solution de loin la plus simple à mettre en œuvre.</p>
</div>
</div>
<div class="sect3">
<h4 id="deuxi-me-solution"><a class="anchor" href="#deuxi-me-solution"></a>Deuxième solution :</h4>
<div class="paragraph">
<p>La première solution demande à travailler avec deux éléments de type différents: <code>Rect</code> et <code>*Rect</code>.
Cette deuxième solution, propose de réunir ces deux éléments dans un <code>StructureUnion</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Structure Rect_
  StructureUnion
    Mthd.Rect
    *Mbers.Rectangle1
  EndStructureUnion
EndStructure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Créer un objet de Classe <code>Rectangle1</code>, reviendra à déclarer l’objet grâce à cette nouvelle <code>Structure</code>.</p>
</div>
<div class="paragraph">
<p>En modifiant en conséquence le constructeur, cela donne :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">New_Rect(@Rect.Rect_)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Avec,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Procedure New_Rect1(*Instance.Rect_, x1.l, x2.l, y1.l, y2.l)
  Shared Mthds_Rect1
  *Rect.Rectangle1 = AllocateMemory(SizeOf(Rectangle1))
  *Rect \Methodes = @Mthds_Rect1
  Init_Mbers_Rect1(*Rect, x1, x2, y1, y2)
  *Instance\Mthds = *Rect
EndProcedure</code></pre>
</div>
</div>
<div class="paragraph">
<p>On accède à la méthode <code>Dessiner()</code> de l’objet en écrivant :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect\Mthds\Dessiner()</code></pre>
</div>
</div>
<div class="paragraph">
<p>On accède à l’attribut <code>var2</code> en écrivant :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-purebasic" data-lang="purebasic">Rect\Mbers\var2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette deuxième solution a pour avantage de ne disposer que d’un seul élément que l’on peut confondre avec un objet dont tous les attributs sont accessibles.
On conserve une notation Objet, bien qu’elle présente un niveau de champs supplémentaire.</p>
</div>
<div class="paragraph">
<p>L’inconvénient porte essentiellement sur le fait qu’il faut entretenir une nouvelle structure au sein de la Classe.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2016-12-06 15:56:04 E
</div>
</div>
<link rel="stylesheet" href="../hjs/styles/github.min.css">
<script src="../hjs/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>